# プロ野球観戦記録アプリ 仕様書（MVP版・npb.jpスクレイピング版）

## 1. 概要
- 観戦記録を投稿・一覧で確認できるアプリケーション。  
- PC / スマホ両対応（レスポンシブ対応）。  
- 試合結果は **npb.jp の公式試合結果ページをスクレイピング** して自動取得。  
- 取得した試合データは **Supabase** に保存し、観戦記録と紐付ける。  
- 対象は自分用〜仲間内シェアを想定。

---

## 2. 機能一覧

### 2.1 観戦記録機能
- 観戦記録の投稿  
  - 試合選択（`games` テーブルから選択）  
  - 観戦場所（球場 / 自宅など）  
  - メモ  
- 投稿の一覧表示  
  - 自分の観戦記録  
  - 他の観戦記録（共有）  

### 2.2 試合データ連携
- **npb.jp の試合結果ページをスクレイピング**して試合データを取得  
- シーズン全体（過去分も含めて）を保存  
- Cron ジョブで定期的に更新（例: 1日1回）  
- 取得内容: 試合日、対戦カード、スコア、球場名

---

## 3. データ設計（Supabase）

### `games` テーブル
| カラム        | 型       | 説明 |
|---------------|---------|------|
| id            | bigint  | PK, 自動採番 |
| game_code     | text    | npb.jp 内の試合識別コード（ユニーク） |
| date          | date    | 試合日 |
| home_team     | text    | ホームチーム名 |
| away_team     | text    | アウェイチーム名 |
| home_score    | int     | ホームスコア |
| away_score    | int     | アウェイスコア |
| stadium       | text    | 球場名 |
| created_at    | timestamp | 登録日時 |

### `records` テーブル（観戦記録）
| カラム        | 型       | 説明 |
|---------------|---------|------|
| id            | bigint  | PK, 自動採番 |
| game_id       | bigint  | `games.id`（外部キー） |
| place         | text    | 観戦場所（球場/自宅など） |
| memo          | text    | メモ |
| created_at    | timestamp | 投稿日時 |

---

## 4. データ取得フロー

1. npb.jp の公式試合結果ページにアクセス  
   - 例: `https://npb.jp/games/2025/schedule.html`  
2. HTMLを解析（スクレイピング）して、以下を抽出  
   - 試合日  
   - 対戦カード（ホーム / アウェイ）  
   - スコア  
   - 球場名  
3. 抽出データを Supabase の `games` テーブルに **UPSERT**  
   - `game_code` をキーとして既存データは更新、新規は追加  
4. Cron ジョブで毎日実行（自動更新）

---

## 5. フロントエンドUI

### 5.1 投稿画面
- ドロップダウン: `games` テーブルから試合を選択  
- 入力欄: 観戦場所 / メモ  

### 5.2 一覧画面
- 投稿一覧（編集/削除可）  
- 試合スコアも表示（スクレイピングで取得したデータと連動）  

---

## 6. 開発環境
- **フロント**: Next.js + Tailwind CSS  
- **バックエンド/DB**: Supabase  
- **データ取得**: npb.jp 試合結果ページのスクレイピング  
- **ホスティング**: Vercel  
- **自動更新**: Vercel Cron Jobs / GitHub Actions  

---

## 7. 注意点
- スクレイピング対象のサイトの HTML構造が変更された場合、取得処理が壊れる可能性がある  
- 商用公開や大量アクセスは控え、仲間内利用を想定  
